Type TLevel
    
	' ########################################################################################################################################################################################################################################################
    ' ####
    ' ####                                                                                                                                                                                                                                 C O N S T A N T S
    ' ####
    ' ########################################################################################################################################################################################################################################################
    
    ' ########################################################################################################################################################################################################################################################
    ' ####
    ' ####                                                                                                                                                                                                                                 V A R I A B L E S
    ' ####
    ' ########################################################################################################################################################################################################################################################
    
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    '                                                                                                                                                                                                                        NUMERIC
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    
    'Summary: Amount of rooms per row.
    Field _width:Int
    
    'Summary: Amount of rooms per column.    
    Field _height:Int
    
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    '                                                                                                                                                                                                                      REFERENCE
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    '                                                                                                                                                                                                                           DATA
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    
    
    'Summary: A link to the first active object. 
    Field _activeFirst:TObject
	
	'Summary: A link to the last active object. 
    Field _activeLast:TObject
    
	'Summary: A list containing all the objects in level
	Field _allObject:TList = new TList
    
    'Summary: Array of all the rooms.
    Field _rooms:TRoom[]
    
    ' ########################################################################################################################################################################################################################################################
    ' ####
    ' ####                                                                                                                                                                                                                       P U B L I C   M E T H O D S
    ' ####
    ' ########################################################################################################################################################################################################################################################
        
    'Summary: Creates a new Level object
    Function Create:TLevel(_width:Int, _height:Int)
		Local this:TLevel = New TLevel
		
        this._width  = _width
        this._height = _height
        
        this._rooms = New TRoom[_width * _height]
		
		Return this
    End Function
    
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    '                                                                                                                                                                                                                         ACTION
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    
    'Summary: Updates all of the Active Objects. 
    Method updateObjects()
        If _activeFirst
			Local lst:TObject = null
			Local cur:TObject = _activeFirst
			Local nxt:TObject = _activeFirst.GetNext()
			
			While cur
				if cur.Update()						'True if the object is to be deleted
					cur.SetNext( Null )				'Remove the link to next from the removed object to free for GC
					if lst							
						lst.SetNext( nxt )
						
					Else 
						_activeFirst = nxt
						
					End If
					
					if nxt = Null					'True if this is the last object in list
						_activeLast = lst 
					End If
					
					cur = nxt
					nxt = cur.GetNext()
				Else
					
					lst = cur
					Cur = nxt
					Nxt = nxt
				End If
			WEnd
		EndIf
    End Method
    
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    '                                                                                                                                                                                                                      MODIFIERS
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	'Summary: Adds an object to the active objects list
	Method addActiveObject(o:TObject)
        if _activeFirst = Null
			_activeFirst = o 
		ElseIf _activeLast
			_activeLast.SetNext( o )
		End If
		
		_activeLast = o
    End Method
    
	'Summary: Sets the room array at location x, y to room
	Method setRoomAt:TRoom(x:Int, y:Int, room:TRoom)
        Assert x >= 0 And y >= 0 And x < _width And y < _height, "setRoomAt out of bounds"
        
        _rooms[ x + y * _width ] = room
    End Method
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    '                                                                                                                                                                                                                       CHECKERS
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    
	'Summary: Returns the room at location x, y in the level
    Method getRoomAt:TRoom(x:Int, y:Int)
        Assert x >= 0 And y >= 0 And x < _width And y < _height, "getRoomAt out of bounds"
        
        return _rooms[ x + y * _width ]
    End Method
    
    ' ########################################################################################################################################################################################################################################################
    ' ####
    ' ####                                                                                                                                                                                                                     P R I V A T E   M E T H O D S
    ' ####
    ' ########################################################################################################################################################################################################################################################
    
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    '                                                                                                                                                                                                                         ACTION
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    '                                                                                                                                                                                                                      MODIFIERS
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    
	' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    '                                                                                                                                                                                                                       CHECKERS
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
    ' ########################################################################################################################################################################################################################################################
    ' ####
    ' ####                                                                                                                                                                                                                 G E T T E R S   /   S E T T E R S
    ' ####
    ' ########################################################################################################################################################################################################################################################
    
	' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    '                                                                                                                                                                                                                        NUMERIC
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    '                                                                                                                                                                                                                      REFERENCE
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    '                                                                                                                                                                                                                           DATA
    ' -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
End Type